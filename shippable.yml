language: ruby

rvm:
  - 2.5.1
  
services:
  - postgres

#  - 2.4.4
#  - 2.5.1
#  - "jruby-1.7.27"
#  - "jruby-9.2.0.0"

build:
  #cache: true
  #cache_dir_list:  
  #  - $SHIPPABLE_BUILD_DIR/shippable.yml
#  pre_ci_boot:
#    image_name: ric03uec/u16ruball
#    image_tag: v6.2.4.patch-2
  ci:
#    - . /etc/profile.d/rvm.sh
    - cd /root
    - cd . && trap
    - trap
#    - rvm version
    - echo "hello world"
    - env
    - mkdir -p $SHIPPABLE_BUILD_DIR/shippable/testresults
    - mkdir -p $SHIPPABLE_BUILD_DIR/shippable/codecoverage
#    - echo "testResults" > shippable/testresults/testreport.xml 
    - pwd
    - cp -vr $SHIPPABLE_BUILD_DIR/coverage_report.xml $SHIPPABLE_BUILD_DIR/shippable/codecoverage/
    - cp -vr $SHIPPABLE_BUILD_DIR/test_report.xml $SHIPPABLE_BUILD_DIR/shippable/testresults/
    
  post_ci:
    - >
      if [ $BRANCH = "master" ] && [ $IS_PULL_REQUEST == "false" ]; then
        ENV=staging;
        IMAGE_NAME=$IMAGE_NAME_STAGING;
      fi;
      if [ $BRANCH = "production" ] && [ $IS_PULL_REQUEST == "false" ]; then
        ENV=staging;
        IMAGE_NAME=$IMAGE_NAME_PRODUCTION;
      fi;
      if [ $ENV ]; then
        echo $ENV;
      fi;
      
integrations:
  hub:
    - integrationName: reg_dh_ric03uec
      type: dockerRegistryLogin
